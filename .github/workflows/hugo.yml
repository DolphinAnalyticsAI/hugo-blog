# Name of this GitHub Actions workflow
name: Deploy Hugo site to Pages

# Controls when the workflow will run
on:
  push:
    branches: ["main"]     # Run when someone pushes to the main branch
  workflow_dispatch:       # Adds a button in GitHub to manually run this workflow

# Permissions needed for GitHub Pages deployment
permissions:
  contents: read          # Allows reading repository contents
  pages: write           # Allows deploying to GitHub Pages
  id-token: write        # Required for deployment authentication

# Ensures only one deployment happens at a time
concurrency:
  group: "pages"
  cancel-in-progress: false

# The actual tasks to run
jobs:
  # First job: Build the Hugo site
  build:
    runs-on: ubuntu-latest    # Use Ubuntu as the operating system
    steps:
      # Step 1: Get your code from GitHub
      - name: Checkout
        uses: actions/checkout@v4
      
      # Step 2: Install Hugo
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'   # Use the latest Hugo version
          extended: true           # Include Sass/SCSS support

      # Step 3: Build your website
      - name: Build with Hugo
        working-directory: ./src   # Go to src folder where Hugo files are
        run: hugo --minify        # Build the website and minimize files

      # Step 4: Save the built website files
      - name: Upload artifact (built site)
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public          # The folder containing your built website

  # Second job: Deploy the site to GitHub Pages
  deploy:
    needs: build                  # Wait for build job to finish first
    runs-on: ubuntu-latest    
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}  # Shows the deployment URL
    
    steps:
      # Deploy the website to GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4